{% extends "index.html" %}

{% block content %}
<style>.
.### {
    position: fixed; /* Фиксированное положение */
    right: 10px; /* Расстояние от правого края окна браузера */
    top: 40%; /* Расстояние сверху */
   }
#table{
border: 5px solid #A1D360;
border-radius: 1px;
margin-top: 2px;
margin-bottom: 2px;
width: 20%;
}
#task{
border: 5px solid #A1D360;
border-radius: 1px;
margin-top: 2px;
top: 30%;
left: 30%;
position: absolute;
margin-bottom: 2px;
width: 20%;
}
@media (min-width: 1016px) and (max-width: 1180px) {
   header {
      padding: 10px 0;
   }
  #task{
border: 5px solid #A1D360;
border-radius: 1px;
margin-top: 2px;
top: 30%;
left: 30%;
position: absolute;
margin-bottom: 2px;
width: 23%;
}
}
@media (min-width: 900px) and (max-width: 1016px) {
   header {
      padding: 10px 0;
   }
  #task{
border: 5px solid #A1D360;
border-radius: 1px;
margin-top: 2px;
top: 30%;
left: 30%;
position: absolute;
margin-bottom: 2px;
width: 25%;
}
}
@media (min-width: 876px) and (max-width: 935px) {
   header {
      padding: 10px 0;
   }
  #task{
border: 5px solid #A1D360;
border-radius: 1px;
margin-top: 2px;
top: 35%;
left: 30%;
position: absolute;
margin-bottom: 2px;
width: 29%;
}
}
@media (min-width: 700px) and (max-width: 876px) {
   header {
      padding: 10px 0;
   }
  #task{
border: 5px solid #A1D360;
border-radius: 1px;
margin-top: 2px;
top: 48%;
left: 30%;
position: absolute;
margin-bottom: 2px;
width: 32%;
}
}
@media  (max-width: 780px) {
   header {
      padding: 10px 0;
   }
  #task{
border: 5px solid #A1D360;
border-radius: 1px;
margin-top: 2px;
top: 55%;
left: 30%;
position: absolute;
margin-bottom: 2px;
width: 37%;
}
#statusbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 26px;
    z-index: 4000000;
    visibility: hidden;
    font-weight: 700;
    text-align: center;
}
.processing {
    visibility: visible !important;
    color: #F7F7F7;
    background-color: #A1D360;
}
.tasks_table    {background: silver}
.tasks_table td {background: white; color: black}
.tasks_table td.act {background: black; color: white}
:active, :hover, :focus {
    outline: 0;
    outline-offset: 0;
}
.name{top: 30%;
left: 30%;}


</style>
<link href="media-queries.css" rel="stylesheet" type="text/css">
<div class="w3-container" id="table">
    <div id="statusbar" class="">Lesson was created</div>
    <label form="classSelect">фильтр по предметам</label>
    <select class="form-control" name="filter" onchange='reload(this)'>
        {% for object in objects %}
        {% if object== object_now%}
        <option value="{{object}}" selected="selected">{{object}}</option>
        {% else %}
        <option value={{object}}> {{object}}</option>
        {% endif %}
        {% endfor %}
    </select>
    <table class="tasks_table" id="s">
        <thead>
        <tr>
            <th>Task_name</th>
        </tr>
        </thead>
        <tbody>
        {% for task in tasks%}
        <tr>
            <td data="{{task}}" onclick="handlerClick(this)">{{task}}</td>
        </tr>
        {% endfor %}
        </tbody>
        <div oncontextmenu="testFunction(elem)"> кликни на меня правой</div>
    </table>
</div>
<div class="w3-container" , id="task">
    <p></p>

    {{form.text_name(class="name", id="lesson_name", placeholder="название урока")}}
    {% for error in form.text_name.errors %}
    <p class="alert alert-danger" role="alert">
        {{ error }}
    </p>
    {% endfor %}


    <ol id="ol" class="tasks_correct">

    </ol>
    <input class="form-button" type="submit" value="Save" onclick="save()"/>
</div>

<script>
function testFunction(elem) {
    timerId = clearTimeout(timerId);
    let liFirst = document.createElement('li');
    liFirst.innerHTML = elem.textContent
    liFirst.id = elem.textContent
    var elem_id = elem.textContent
    liFirst.setAttribute('class', 'good')
    liFirst.setAttribute('onclick', 'remove_it("'+elem_id+'")');
  ol.prepend(liFirst);
}
function r(elem)
{timerId = clearTimeout(timerId);
var win=window.open("{{base_url}}/view_task/" + elem.textContent + "/");
}

function remove_it(elem_id){document.getElementById(elem_id).remove();}

async function save(){const formData = new FormData();
var val = document.getElementById('lesson_name').value;
var a = Array.from(document.getElementsByClassName("good"));
var lst = []
a.forEach(function(element){lst.push(element.textContent);});
formData.append('array', lst)
formData.append('name', val)
if (val.length ==0) {alert("введите имя урока");}
else if (lst.length ==0) {alert("выберите задачи, из которых будет состоять урок");}
else{
fetch("{{base_url}}/" + "lesson", {method: 'POST',
body: formData});
ShowStatusbar();
await sleep(3 * 1000);
HideStatusbar();};

}
function reload(filter_name){window.location = "{{base_url}}create_lesson/"+ filter_name.value + "/";
}
function ShowStatusbar() {
        document.getElementById("statusbar").className = "processing";
    };

    function HideStatusbar() {
        document.getElementById("statusbar").className = "";
    }
function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
let timerId = null;
function handlerClick(elem) {
  if (!timerId) {
    timerId = setTimeout(() => {
      r(elem)
    }, 200);
  } else {
    testFunction(elem)
  }

}

</script>

{% endblock %}